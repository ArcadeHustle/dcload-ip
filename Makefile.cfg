# determine on what platform we are running
# TODO: add all detection for others platforms (Linux, OSX and Cygwin...)
ifeq ($(shell uname -s | cut -c-7),MINGW32)
  MINGW32 = 1
endif

# host compiler and flags
HOSTCC		= gcc
HOSTCFLAGS	= -O2
HOSTLDFLAGS	=
# cygwin may need this
#HOSTCFLAGS	= -O2 -D_WIN32

ifdef MINGW32
  HOSTCFLAGS += -D_WIN32
endif

# dc compiler prefix -- this is usually what you used for --prefix when
# building your compiler.
TARGETPREFIX	= /opt/toolchains/dc/sh-elf

# you may have to change the paths for BFDLIB and BFDINCLUDE to
# the ones in your system

# these must point to your sh-elf bfd, not the system one
BFDLIB		= -L$(TARGETPREFIX)/lib -lbfd -liberty -lintl -lz
BFDINCLUDE	= -I$(TARGETPREFIX)/include

# MinGW
ifdef MINGW32
  BFDLIB	+= -lws2_32 -lwsock32 -liconv
endif

# this flag will be set to true if BFD is enabled by using the above definitions
ifeq ($(call ifndef_any_of,BFDLIB BFDINCLUDE),)
  WITH_BFD = 1
endif

# When using libelf instead of BFD, these must point to your
# libelf installation (leave empty or undefined if libelf is part of the system)
ELFLIB		= -L$(TARGETPREFIX)/lib
ELFINCLUDE	= -I$(TARGETPREFIX)/include

# sh-elf-stuff
# if you have the SH compiler in your path you can leave SHTOOLS empty,
# otherwise set it to the bin directory of your SH compiler installation
# (include trailing slash)
#SHTOOLS	= /opt/dcgcc-4.7.0/sh-elf/bin/
SHTOOLS		=
TARGETCC	= $(SHTOOLS)sh-elf-gcc
TARGETCFLAGS	= -O2 -ml -m4-single-only
TARGETOBJCOPY	= $(SHTOOLS)sh-elf-objcopy
TARGETLD	= $(SHTOOLS)sh-elf-ld
# set TARGETCCVER to 3 or 4, depending on your SH compiler version (gcc 3.x or gcc 4.x)
# this line tries to detect the version automatically
TARGETCCVER	= $(shell $(TARGETCC) --version | head -1 | sed  "s/.* \([[:digit:]][[:digit:]]*\)\.[[:digit:]][[:digit:]]*.*/\1/")

# you generally shouldn't change this unless you are making forked
# versions (or test versions)
VERFLAGS	= -DDCLOAD_VERSION=\"1.0.5\"
TARGETCFLAGS	+= $(VERFLAGS)
HOSTCFLAGS	+= $(VERFLAGS)

# the ip of your dreamcast - set to 0.0.0.0 if you want to use arp on pc
# note: setting 4x "000" can set the dcload-ip binary hex-editable for configuring the IP if needed...
DREAMCAST_IP	= 000.000.000.000

# dir to install dc-tool in
TOOLINSTALLDIR	= /opt/toolchains/dc/bin

# uncomment this for cygwin
#EXECUTABLEEXTENSION = .exe

ifdef MINGW32
  EXECUTABLEEXTENSION = .exe
endif

# Define this if you want a standalone, no dependency binary under MinGW/MSYS
#STANDALONE_BINARY = 1
